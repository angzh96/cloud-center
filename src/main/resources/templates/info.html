<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>websocket通讯</title>
</head>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.js"></script>
<script>
    function openSocket(carID) {
        var socket;
        if(typeof(WebSocket) == "undefined") {
            console.log("您的浏览器不支持WebSocket");
        }else{
            console.log("您的浏览器支持WebSocket");
            //实现化WebSocket对象，指定要连接的服务器地址与端口  建立连接
            //等同于socket = new WebSocket("ws://localhost:8888/xxxx/im/25");
            var socketUrl="http://localhost:6382/imserver/"+carID;
            socketUrl=socketUrl.replace("https","ws").replace("http","ws");
            console.log(socketUrl);
           /* if(socket!=null){
                socket.close();
                socket=null;
            }*/
            socket = new WebSocket(socketUrl);
            //打开事件
            socket.onopen = function() {
                console.log("websocket已打开");
                //socket.send("这是来自客户端的消息" + location.href + new Date());
            };
            //获得消息事件
            socket.onmessage = function(msg) {
                var obj = eval('(' + msg.data + ')');
                console.log(obj.code);
                var timeid = 'time'+obj.code
                var lonid = 'lon'+obj.code
                var latid = 'lat'+obj.code
                var temid = 'tem'+obj.code
                var humid = 'hum'+obj.code
                var windid = 'wind'+obj.code
                document.getElementById(timeid).value =obj.time;
                document.getElementById(lonid).value =obj.longitude;
                document.getElementById(latid).value =obj.latitude;
                document.getElementById(temid).value =obj.temperature;
                document.getElementById(humid).value =obj.humidity;
                document.getElementById(windid).value =obj.wind;
                //发现消息进入    开始处理前端触发逻辑
            };
            //关闭事件
            socket.onclose = function() {
                console.log("websocket已关闭");
            };
            //发生了错误事件
            socket.onerror = function() {
                console.log("websocket发生了错误");
            }
        }
    }
    function sendMessage() {
        if(typeof(WebSocket) == "undefined") {
            console.log("您的浏览器不支持WebSocket");
        }else {
            console.log("您的浏览器支持WebSocket");
            console.log('{"toUserId":"'+$("#toUserId").val()+'","contentText":"'+$("#contentText").val()+'"}');
            socket.send('{"toUserId":"'+$("#toUserId").val()+'","contentText":"'+$("#contentText").val()+'"}');
        }
    }
</script>
<body>
<p>【设备ID】：<input id="userId" name="userId" type="text" value="car1"></p>
<p><button onclick="openSocket(userId.value)">开启socket</button></p>
<p>数据实时显示：</p>
<p>时间：<input id="time1" name="time1" type="text" value="0"> </p>
<p>经度：<input id="lon1" name="lon1" type="text" value="0"> </p>
<p>纬度：<input id="lat1" name="lat1" type="text" value="0"> </p>
<p>温度：<input id="tem1" name="tem1" type="text" value="0"> </p>
<p>湿度：<input id="hum1" name="hum1" type="text" value="0"></p>
<p>风速：<input id="wind1" name="wind1" type="text" value="0"></p>
<br>

<p>【设备ID】：<input id="userId2" name="userId2" type="text" value="car2"></p>
<p><button onclick="openSocket(userId2.value)">开启socket</button></p>
<p>数据实时显示：</p>
<p>时间：<input id="time2" name="time2" type="text" value="0"> </p>
<p>经度：<input id="lon2" name="lon2" type="text" value="0"> </p>
<p>纬度：<input id="lat2" name="lat2" type="text" value="0"> </p>
<p>温度：<input id="tem2" name="tem2" type="text" value="0"> </p>
<p>湿度：<input id="hum2" name="hum2" type="text" value="0"></p>
<p>风速：<input id="wind2" name="wind2" type="text" value="0"></p>
<br>
</body>

</html>
